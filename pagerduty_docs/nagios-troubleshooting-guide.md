

Getting Started
---------------

* [Introduction](/main/docs/introduction)
* [Trial Account Onboarding](/main/docs/trial-account-onboarding)
* [Log In to PagerDuty](/main/docs/log-in-to-pagerduty)
* [Navigate the Incidents Page](/main/docs/navigate-the-incidents-page)
* [Best Practice Ops Guides](https://www.pagerduty.com/ops-guides/)

Incidents
---------

* [Incidents](/main/docs/incidents)
  + [Edit Incidents](/main/docs/edit-incidents)
  + [Reassign Incidents](/main/docs/reassign-incidents)
  + [Incident Priority](/main/docs/incident-priority)
  + [Incident Roles](/main/docs/incident-roles)
  + [Incident Tasks](/main/docs/incident-tasks)
  + [Incident Types](/main/docs/incident-types)
  + [Custom Fields on Incidents](/main/docs/custom-fields-on-incidents)
  + [Why Incidents Fail to Trigger](/main/docs/why-incidents-fail-to-trigger)
  + [Conference Bridge](/main/docs/conference-bridge)
  + [Add Responders](/main/docs/add-responders)
  + [Event Management](/main/docs/event-management)
  + [Dynamic Notifications](/main/docs/dynamic-notifications)
  + [Communicate with Stakeholders](/main/docs/communicate-with-stakeholders)
  + [Status Update Templates](/main/docs/status-update-templates)
* [Alerts](/main/docs/alerts)
  + [Alerts Table](/main/docs/alerts-table)
* [Postmortems and Jeli Post Incident Reviews](/main/docs/postmortems)
* [Visibility Console](/main/docs/visibility-console)

Notifications
-------------

* [Notification Content and Behavior](/main/docs/notification-content-and-behavior)
  + [Push Notifications](/main/docs/push-notifications)
  + [Email Notifications](/main/docs/email-notifications)
  + [Phone Notifications](/main/docs/phone-notifications)
    - [Phone Notification Disclosures](/main/docs/phone-notification-disclosures)
  + [SMS Notifications](/main/docs/sms-notifications)
    - [SMS Notification Disclosures](/main/docs/sms-notification-disclosures)
* [Notification Troubleshooting](/main/docs/notification-troubleshooting)
  + [Expected Notification Behavior](/main/docs/expected-notification-behavior)
  + [Push Notification Troubleshooting](/main/docs/push-notification-troubleshooting)
  + [Email Notification Troubleshooting](/main/docs/email-notification-troubleshooting)
  + [Phone Notification Troubleshooting](/main/docs/phone-notification-troubleshooting)
  + [SMS Notification Troubleshooting](/main/docs/sms-notification-troubleshooting)
* [Supported Countries](/main/docs/supported-countries)
* [Notification Phone Numbers](/main/docs/notification-phone-numbers)

Services
--------

* [Services and Integrations](/main/docs/services-and-integrations)
  + [Service Directory](/main/docs/service-directory)
  + [Service Profile](/main/docs/service-profile)
  + [Business Services](/main/docs/business-services)
    - [Business Service Subscription](/main/docs/business-service-subscription)
  + [Service Graph](/main/docs/service-graph)
  + [Maintenance Windows](/main/docs/maintenance-windows)
  + [Email Management: Filters and Rules](/main/docs/email-management-filters-and-rules)
  + [Regular Expressions](/main/docs/regular-expressions)
* [Configurable Service Settings](/main/docs/configurable-service-settings)
* [Integrate PagerDuty With ITSM Tools](/main/docs/integrating-with-itsm-tools)

People
------

* [Manage Users](/main/docs/manage-users)
  + [Import Users from a CSV](/main/docs/import-users-from-a-csv)
  + [Offboarding](/main/docs/offboarding)
* [User Roles](/main/docs/user-roles)
* [Advanced Permissions](/main/docs/advanced-permissions)
* [User Profile](/main/docs/user-profile)
* [Teams](/main/docs/teams)
* [Contextual Search - Tagging](/main/docs/contextual-search)
* [Schedule Basics](/main/docs/schedule-basics)
  + [Edit Schedules](/main/docs/edit-schedules)
* [Schedule Examples](/main/docs/schedule-examples)
* [Schedules in Third-Party Apps](/main/docs/schedules-in-apps)
* [My On-Call Shifts](/main/docs/my-on-call-shifts)
* [Escalation Policy Basics](/main/docs/escalation-policies)
  + [Round Robin Scheduling](/main/docs/round-robin-scheduling)
* [Escalation Policies and Schedules](/main/docs/escalation-policies-and-schedules)

Integrations
------------

* [Amazon CloudWatch Integration Guide | PagerDuty](/main/docs/amazon-cloudwatch-integration-guide)
* [Amazon EventBridge Integration Guide | PagerDuty](/main/docs/amazon-eventbridge-integration-guide)
* [Amazon GuardDuty Integration Guide | PagerDuty](/main/docs/aws-guardduty-integration-guide)
* [AWS CloudTrail Integration Guide | PagerDuty](/main/docs/aws-cloudtrail-integration-guide)
* [AWS Health Dashboard Integration Guide | PagerDuty](/main/docs/aws-health-dashboard)
* [AWS Security Hub Integration Guide | PagerDuty](/main/docs/aws-security-hub-integration-guide-pagerduty)
* [Bitbucket Integration Guide | PagerDuty](/main/docs/bitbucket)
* [Datadog Apps Integration Guide | PagerDuty](/main/docs/datadog-apps-integration-guide)
* [Email Integration Guide | PagerDuty](/main/docs/email-integration-guide)
* [GitHub Changes Integration Guide | PagerDuty](/main/docs/github-changes)
* [GitLab Changes Integration Guide | PagerDuty](/main/docs/gitlab-changes)
* [Jenkins Changes Integration Guide | PagerDuty](/main/docs/jenkins-changes)
* [Jira Cloud Integration Guide | PagerDuty](/main/docs/jira-cloud)
  + [Jira Cloud User Guide](/main/docs/jira-cloud-user-guide)
  + [Jira Cloud Integration FAQ](/main/docs/jira-cloud-integration-faq)
  + [Jira Cloud Troubleshooting Guide](/main/docs/jira-cloud-troubleshooting-guide)
* [Jira Server Integration Guide | PagerDuty](/main/docs/jira-server)
  + [Jira Server Troubleshooting Guide](/main/docs/jira-server-troubleshooting-guide)
* [Microsoft Teams Integration Guide | PagerDuty](/main/docs/microsoft-teams)
  + [Microsoft Teams User Guide](/main/docs/microsoft-teams-user-guide)
  + [Microsoft Teams Permission Changelog](/main/docs/microsoft-teams-permission-changelog)
* [Salesforce Service Cloud Integration Guide | PagerDuty](/main/docs/salesforce-service-cloud-integration-guide)
  + [Salesforce Service Cloud User Guide](/main/docs/salesforce-service-cloud-user-guide)
  + [Salesforce Custom Field Mappings](/main/docs/salesforce-custom-field-mappings)
* [ServiceNow Integration Guide | PagerDuty](/main/docs/servicenow-integration-guide)
  + [ServiceNow Integration Details](/main/docs/servicenow-integration-details)
  + [ServiceNow User Guide](/main/docs/servicenow-user-guide)
  + [ServiceNow Provisioning](/main/docs/servicenow-provisioning)
  + [Advanced ServiceNow Configuration](/main/docs/advanced-servicenow-configuration)
  + [ServiceNow Change Requests Integration Guide](/main/docs/servicenow-change-requests-integration-guide)
  + [ServiceNow Troubleshooting Guide](/main/docs/servicenow-troubleshooting-guide)
* [ServiceNow CSM Integration Guide](/main/docs/servicenow-csm-integration-guide)
  + [ServiceNow CSM User Guide](/main/docs/servicenow-csm-user-guide)
* [Slack Integration Guide | PagerDuty](/main/docs/slack-integration-guide)
  + [Slack User Guide](/main/docs/slack-user-guide)
  + [Slack Permission Changelog](/main/docs/slack-permission-changelog)
* [Zendesk Integration Guide | PagerDuty](/main/docs/zendesk-integration-guide)
  + [Zendesk User Guide](/main/docs/zendesk-user-guide)
  + [Zendesk Custom Field Mappings](/main/docs/zendesk-custom-field-mappings)
* [Zoom Integration Guide | PagerDuty](/main/docs/zoom-integration-guide)
* [Nagios Troubleshooting Guide](/main/docs/nagios-troubleshooting-guide)
* [PagerDuty Agent Integration Guide](/main/docs/pagerduty-agent-integration-guide)
* [PagerDuty Agent Troubleshooting Guide](/main/docs/pagerduty-agent-troubleshooting-guide)
* [SolarWinds Orion Troubleshooting Guide](/main/docs/solarwinds-orion-troubleshooting-guide)
* [Zabbix Troubleshooting Guide](/main/docs/zabbix-troubleshooting-guide)
* [Extensions](/main/docs/extensions)
* [Add-ons](/main/docs/add-ons)
* [Webhooks](/main/docs/webhooks)
* [Custom Incident Actions](/main/docs/custom-incident-actions)
* [Single Sign-On (SSO)](/main/docs/sso)
* [Live Call Routing](/main/docs/live-call-routing)
* [Apps](/main/docs/apps)

Automation
----------

* [PagerDuty Automation Actions](/main/docs/automation-actions)
  + [PagerDuty Automation Trial](/main/docs/pagerduty-automation-trial)
* [Incident Workflows](/main/docs/incident-workflows)
  + [Workflow Integrations](/main/docs/workflow-integrations)
  + [Workflow Actions](https://support.pagerduty.com/actions/docs/incident-workflow-actions-overview)
* [PagerDuty Workflow Automation](https://help.catalytic.com/)
* [PagerDuty Runbook Automation](https://docs.rundeck.com/docs/)

Generative AI
-------------

* [PagerDuty Advance](/main/docs/pagerduty-advance)

AIOps
-----

* [PagerDuty AIOps](/main/docs/aiops)
  + [PagerDuty AIOps Quickstart Guide](/main/docs/pagerduty-aiops-quickstart-guide)
  + [Intelligent Alert Grouping](/main/docs/intelligent-alert-grouping)
    - [Preview Intelligent Alert Grouping](/main/docs/preview-intelligent-alert-grouping)
  + [Content-Based Alert Grouping](/main/docs/content-based-alert-grouping)
  + [Unified Alert Grouping](/main/docs/unified-alert-grouping)
  + [Global Alert Grouping](/main/docs/global-alert-grouping)
  + [Time-Based Alert Grouping](/main/docs/time-based-alert-grouping)
  + [Auto-Pause Incident Notifications](/main/docs/auto-pause-incident-notifications)
  + [Alert Suppression](https://support.pagerduty.com/docs/event-orchestration#incident-data)
  + [Past Incidents](/main/docs/past-incidents)
  + [Related Incidents](/main/docs/related-incidents)
  + [Outlier Incident](/main/docs/outlier-incident)
  + [Probable Origin](/main/docs/probable-origin)
  + [Recent Changes](/main/docs/recent-changes)
  + [Event Orchestration](/main/docs/event-orchestration)
    - [Event Orchestration Cache Variables](/main/docs/event-orchestration-cache-variables)
    - [Event Orchestration Examples](/main/docs/event-orchestration-examples)
  + [Operations Console](/main/docs/operations-console)
* [Legacy Event Intelligence](/main/docs/legacy-event-intelligence)
* [Rulesets](/main/docs/rulesets)
* [Migrate to Event Orchestration](/main/docs/migrate-to-event-orchestration)

Analytics
---------

* [Analytics Dashboard](/main/docs/analytics-dashboard)
* [Insights](/main/docs/insights)
* [Operational Reviews](/main/docs/operational-reviews)
* [On-Call Readiness Reports](/main/docs/on-call-readiness-reports)
* [Event Analytics](/main/docs/event-analytics)
* [PagerDuty Advance Analytics](/main/docs/pagerduty-advance-analytics)
* [User Onboarding Report](/main/docs/user-onboarding-report)
* [Recommendations](/main/docs/recommendations)
* [Audit Trail Reporting](/main/docs/audit-trail-reporting)
* [PagerDuty Analytics Slack Integration](/main/docs/pagerduty-analytics-slack-integration)
* [Operational Maturity](/main/docs/operational-maturity)

APIs
----

* [APIs Overview](https://developer.pagerduty.com/docs/ZG9jOjQ2NDA2-introduction)
* [API Access Keys](/main/docs/api-access-keys)
  + [REST API Rate Limits](/main/docs/rest-api-rate-limits)
* [Developer Documentation](https://v2.developer.pagerduty.com/docs)
* [API Client Libraries](https://developer.pagerduty.com/docs/tools-libraries/client-libraries/?utm_source=web&utm_campaign=kb_nav&utm_medium=link)
* [Safelist IPs](/main/docs/safelist-ips)
* [Third-Party Tools](/main/docs/third-party-tools)
  + [API Tools & Code Samples](https://developer.pagerduty.com/docs/tools-libraries/tools-projects/?utm_source=web&utm_campaign=kb_nav&utm_medium=link)

Status
------

* [Status Pages Overview](/main/docs/status-pages-overview)
* [Internal Status Page](/main/docs/internal-status-page)
* [External Status Page](/main/docs/external-status-page)
  + [Private Status Page](/main/docs/private-status-page)

Billing and Account Settings
----------------------------

* [Billing, Invoices and Payments](/main/docs/billing-invoices-payments)
  + [Form W-9](/main/docs/w-9)
  + [Vendor Form](/main/docs/vendor-form)
  + [Cancel Your Account](/main/docs/cancel-your-account)
* [Account Settings](/main/docs/account-settings)
* [Account Subdomains](/main/docs/account-subdomains)
* [Time Zone Settings](/main/docs/time-zone-settings)

Mobile App
----------

* [Training Material](https://university.pagerduty.com/page/on-demand#new-to-pagerduty_getting-started)
* [PagerDuty Mobile App](/main/docs/mobile-app)
  + [Mobile Home Screen](/main/docs/mobile-home-screen)
  + [Mobile Widgets](/main/docs/mobile-widgets)
* [Mobile App Settings](/main/docs/mobile-app-settings)
* [Use Mobile Schedules](/main/docs/use-mobile-schedules)
* [Mobile Status Dashboard](/main/docs/mobile-status-dashboard)
  + [Home Screen Status Dashboard](/main/docs/home-screen-status-dashboard)
* [MDM Setup and Supported Web Browsers](/main/docs/mdm-setup-browsers)
* [Mobile Release Notes](/main/docs/release-notes)

Platform
--------

* [What's New in PagerDuty](https://www.pagerduty.com/whats-new)
* [Platform Release Notes](/main/docs/platform-release-notes)
  + [Platform Release Notes (2023)](/main/docs/platform-release-notes-2023)
  + [Platform Release Notes (2022)](/main/docs/platform-release-notes-2022)
  + [Platform Release Notes (2021)](/main/docs/platform-release-notes-2021)
  + [Platform Release Notes (2020)](/main/docs/platform-release-notes-2020)
  + [Platform Release Notes (2019)](/main/docs/platform-release-notes-2019)
  + [Platform Release Notes (2018)](/main/docs/platform-release-notes-2018)
  + [Platform Release Notes (2017)](/main/docs/platform-release-notes-2017)
* [System Requirements](/main/docs/system-requirements)
* [Common Event Format (PD-CEF)](/main/docs/pd-cef)
* [Search](/main/docs/search)
* [PagerDuty Outage Notifications](/main/docs/pagerduty-outage-notifications)
* [Service Regions](/main/docs/service-regions)

Jeli part of PagerDuty
----------------------

* [Get Started With Jeli](/main/docs/get-started-with-jeli)
* [Jeli Incidents](/main/docs/jeli-incidents)
  + [Jeli Slackbot Commands](/main/docs/jeli-slackbot-commands)
  + [Mitigate a Jeli Incident](/main/docs/mitigate-an-incident)
* [Jeli Workflows](/main/docs/jeli-workflows)
* [Jeli Opportunities](/main/docs/opportunities)
  + [Basic Investigation Tutorial](/main/docs/basic-investigation-tutorial)
  + [Opportunity Stages](/main/docs/opportunity-stages)
  + [Opportunity Report](/main/docs/opportunity-report)
    - [Incident Review Templates](/main/docs/incident-review-templates)
    - [Opportunity Tags](/main/docs/opportunity-tags)
    - [Related Opportunities](/main/docs/related-opportunities)
    - [Narrative Builder](/main/docs/narrative-builder)
    - [Narrative Builder Tutorial](/main/docs/narrative-builder-tutorial)
    - [View Opportunity Participant Data](/main/docs/see-participant-information)
    - [Collect Action Items](/main/docs/collect-action-items)
  + [Opportunity Notes](/main/docs/opportunity-notes)
  + [Opportunity Events](/main/docs/opportunity-events)
* [Jeli Learning Center](/main/docs/learning-center)
* [View People in Jeli](/main/docs/view-people-in-jeli)
* [Jeli Settings and Integrations](/main/docs/jeli-settings-and-integrations)
  + [Entra ID Integration | Jeli](/main/docs/entra-id-integration-jeli)
  + [Google Meet Integration | Jeli](/main/docs/google-meet-integration-jeli)
  + [Jira Integration | Jeli](/main/docs/jira-integration-jeli)
  + [Nobl9 Integration | Jeli](/main/docs/nobl9-integration-jeli)
  + [Okta Integration | Jeli](/main/docs/okta-integration-jeli)
  + [Opsgenie Integration | Jeli](/main/docs/opsgenie-integration-jeli)
  + [PagerDuty Integration | Jeli](/main/docs/pagerduty-integration-jeli)
  + [ServiceNow Integration | Jeli](/main/docs/servicenow-integration-jeli)
  + [Slack Integration | Jeli](/main/docs/slack-integration-jeli)
  + [Statuspage Integration | Jeli](/main/docs/statuspage-integration-jeli)
  + [Vanta Integration | Jeli](/main/docs/vanta-integration-jeli)
  + [Zoom Integration | Jeli](/main/docs/zoom-integration-jeli)
  + [Import HR Data](/main/docs/import-hr-data)
  + [Jeli API](/main/docs/jeli-api)

Security
--------

* [PagerDuty and CISA 0-Day Vulnerability Remediation Timelines](/main/docs/pagerduty-and-cisa-0-day-vulnerability-remediation-timelines)
* [PagerDuty Log4j Zero-Day Vulnerability Updates](/main/docs/pagerduty-log4j-zero-day-vulnerability)
* [PagerDuty Runbook Automation Self-Hosted / Rundeck Key Pair Misconfiguration](/main/docs/pagerduty-rundeck-automation-self-hosted-key-pair-misconfiguration)
* [Security Hygiene for the Current Cyber Threat Landscape](/main/docs/security-hygiene-for-the-current-cyber-threat-landscape)
* [Sisense Compromise](/main/docs/sisense-compromise)

Support
-------

* [Support Portal FAQ](/main/docs/support-portal-faq)

Nagios Troubleshooting Guide
============================

This guide addresses common issues related to the Nagios integration. Depending on your integration type, you may run into errors specific to your environment:

* [General Configuration](#general-configuration)
* [Perl-Based Integration](#section-perl-based-integration)
* [Agent-Based Integration](#section-agent-based-integration)
* [Bi-Directional Integration](#section-bi-directional-integration)

General Configuration
=====================

If Nagios notifications are not triggering PagerDuty incidents as expected, the following items apply to all integration types.

Your Nagios host or service may not be reaching a HARD down state
-----------------------------------------------------------------

Events are only sent to PagerDuty when your service or host changes state to `HARD`. Typically, a host or service will first enter a `SOFT` state, and only transition to `HARD` after it reaches its `max_check_attempts` limit.

For more information, please see Nagiosâ€™ [State Types](https://assets.nagios.com/downloads/nagioscore/docs/nagioscore/3/en/statetypes.html) documentation.

To verify whether this is happening:

1. Check your logs.
   * **Debian/Ubuntu**: `/var/log/syslog`
   * **RHEL/CentOS**: `/var/log/messages`
2. Run `grep pagerduty <log path>` to see notifications sent to PagerDuty.

This is an example of a `SOFT` down, which would **not** trigger an incident in PagerDuty:

Shell
```
Nov 13 22:34:30 ip-10-182-165-131 nagios3: SERVICE ALERT: localhost;Current Users;WARNING;SOFT;1;USERS WARNING - 2 users currently logged in

```

This is an example of a `HARD` down, which should trigger incidents in PagerDuty:

Shell
```
Nov 13 22:34:30 ip-10-182-165-131 nagios3: SERVICE NOTIFICATION: pagerduty;localhost;Current Users;WARNING;notify-service-by-pagerduty;USERS WARNING - 3 users currently logged in

```
### Confirm that your PagerDuty contact is configured properly

The `pagerduty` contact might not have been configured to receive notifications properly.

To check this, run `grep NOTIFICATION <log path>`.

If, as in the example below, "pagerduty" is not listed in your logs, check to make sure that the `pagerduty` contact is included in the contact group, which is configured to receive notifications under the service or host template:

Shell
```
Nov 13 22:34:30 ip-10-182-165-131 nagios3: SERVICE NOTIFICATION: root;localhost;Current Users;CRITICAL;notify-service-by-email;USERS CRITICAL - 5 users currently logged in

```
> ðŸ“˜ Nagios XI vs. Nagios Core file paths
> --------------------------------------
> 
> If you use Nagios XI, paths will differ from Nagios Core. Additionally, configuration is managed primarily through the Nagios XI web interface, as opposed to Nagios Coreâ€™s configuration files. Please refer to the [Nagios XI Integration Guide](https://www.pagerduty.com/docs/guides/nagios-xi-integration-guide/) for further details.

If you use the default configuration, open the file that contains the `pagerduty` contact to confirm it is included in the correct contact group:

* **Debian, Ubuntu, and other Debian-derived systems**: `/etc/nagios3/conf.d/contacts_nagios2.cfg`
* **RHEL, Fedora, CentOS, and other Redhat-derived systems**: `/etc/nagios/objects/contacts.cfg`

If you use the default configuration, open the following file to make sure that the `pagerduty` contact is defined properly.

* **Debian, Ubuntu, and other Debian-derived systems**: `/etc/nagios3/conf.d/pagerduty_nagios.cfg`
* **RHEL, Fedora, CentOS, and other Redhat-derived systems**: `/etc/nagios/objects/pagerduty_nagios.cfg`

If you use the default configuration, open the following file to confirm that the host or service template being used is contacting the correct group.

* **Debian, Ubuntu, and other Debian-derived systems**: `/etc/nagios3/conf.d/generic-service_nagios.cfg`, `/etc/nagios3/conf.d/generic-host_nagios2.cfg`
* **RHEL, Fedora, CentOS, and other Redhat-derived systems**: `/etc/nagios/objects/generic-service_nagios2.cfg`, `/ect/nagios/objects/generic-host_nagios2.cfg`

If you make any changes to the templates above, **make sure to restart Nagios**:

Shell
```
/etc/init.d/nagios3 restart

```

*or*

Shell
```
service nagios3 restart

```

[ERROR] NOTIFICATIONTYPE field must be present
----------------------------------------------

The PagerDuty integration accepts the following Nagios notifications:

* `PROBLEM`
* `ACKNOWLEDGE`
* `RECOVERY`

Other event types (e.g., `FLAPPINGSTART` and `FLAPPINGSTOP`) are not supported, and will result in a `NOTIFICATIONTYPE` error.

Please also note that sending a custom notification manually through the Nagios UI will not trigger an incident, as the integration does not support custom notifications.

If you are using the agentless integration and would like to receive `FLAPPINGSTART` and `FLAPPINGSTOP` events, you can update the `enqueue_event` subroutine in the `pagerduty_nagios.pl` script (below line 235):

Perl
```
if ($event{"NOTIFICATIONTYPE"} eq "FLAPPINGSTART") {
    $event{"NOTIFICATIONTYPE"} = "PROBLEM";
   }
if ($event{"NOTIFICATIONTYPE"} eq "FLAPPINGSTOP") {
    $event{"NOTIFICATIONTYPE"} = "RECOVERY";
   }

```

Make sure that you have enabled flapping notifications in your `pagerduty_nagios.cfg` file under the `service_notification_options` and/or `host_notification_options` fields.

Perl-Based Integration
======================

> ðŸ“˜ Tip
> -----
> 
> Use the Perl integration if you use CentOS 5 or lower.

Trigger a test incident to make sure that the Perl script will run
------------------------------------------------------------------

* Manually trigger a Nagios incident with the Perl script to make sure it runs.
* Make sure that you are logged in as the Nagios user, or add `sudo -u nagios` to your command.
  + If you are logged in as the user that runs Nagios (typically the "nagios" user), you can omit this from your commands.

[ERROR] Nagios event in file /tmp/pagerduty\_nagios/pd\_12334543223\_1235.txt DEFERRED due to network/server problems.
----------------------------------------------------------------------------------------------------------------------

If your server is behind a proxy, you will need to specify it when executing the Perl script. Add the following switch to the Nagios command that calls the script, as well as your cron job:

`--proxy https://my.proxy.com:<port>`

Also, verify that the Perl libraries for SSL are installed (typically step 1 of the integration guide).

* **For Debian-based systems (i.e., Ubuntu):**

Shell
```
aptitude install libwww-perl libcrypt-ssleay-perl

```

* **For RHEL-based systems (i.e., CentOS, Fedora)**:

Shell
```
yum install perl-libwww-perl perl-Crypt-SSLeay

```

Then run the following:

Shell
```
sudo -u nagios <path to perl script> flush --verbose

```

If you get a `500` response of `Can't verify SSL peers without knowing which Certificate Authorities to trust`, install the Mozilla::CA module by running the following command:

Shell
```
cpanm Mozilla::CA

```

[ERROR] May 16 07:12:46 sw-cloud pagerduty\_nagios[32356]: open /tmp/pagerduty\_nagios/pd\_1337123566\_32999.txt for write failed: Illegal seek
-----------------------------------------------------------------------------------------------------------------------------------------------

This error means that the user running Nagios does not have write permissions to the `/tmp/pagerduty_nagios/` directory. The easiest solution to fix this is to delete the directory. Note, this will remove any queued alerts:

Shell
```
rm -rf /tmp/pagerduty_nagios

```

[ERROR] File was rejected because could not find CONTACTPAGER
-------------------------------------------------------------

If you see this error, you will need to enable environment variables by setting the following `enable_environment_macros=1` in your `nagios.cfg` file:

* **Debian, Ubuntu, and other Debian-derived systems**: `/etc/nagios3/nagios.cfg`
* **RHEL, Fedora, CentOS, and other Redhat-derived systems**: `/etc/nagios/nagios.cfg`

Agent-Based Integration
=======================

Below are some issues that may arise with an agent-based integration while using the [PagerDuty Agent](https://www.pagerduty.com/docs/guides/agent-install-guide/).

Trigger a test incident to make sure that the agent works
---------------------------------------------------------

Manually trigger a Nagios incident with the `pd-send` command to make sure the agent is working.

Replace `YOUR-INTEGRATION-KEY-HERE` with your actual integration key in the commands below:

Shell
```
sudo -u nagios /usr/share/pdagent-integrations/bin/pd-nagios -n service -k YOUR-INTEGRATION-KEY-HERE -t "PROBLEM" -f SERVICEDESC="test_description" -f SERVICESTATE="CRITICAL" -f HOSTNAME="test_host_name" -f SERVICEOUTPUT="test_service_output"

```

Alternatively, you can use the `pd-send` command to trigger an incident.

Here is an example event to trigger an incident using pd-send:

Shell
```
~$ export PD_INTEGRATION_KEY=YOUR-INTEGRATION-KEY-HERE
~$ pd-send -k $YOUR-INTEGRATION-KEY-HERE -t trigger -d "Server is on fire" -i server.fire
Event processed. Incident Key: server.fire

```

[ERROR] Error Performing CheckSum
---------------------------------

This is an installation error on CentOS 5 and below. The agent supports CentOS 6 and higher. If you are running CentOS 5 or below, please use the [Agentless Nagios Integration Guide](https://www.pagerduty.com/docs/guides/nagios-perl-integration-guide/).

Agent is not running
--------------------

Check to make sure that the PD agent is running. To do this, run the following command:

Shell
```
service pdagent status

```

If the status is "not running", then start the PD agent with the following command:

Shell
```
service pdagent start

```

Outdated agent version
----------------------

If you see something similar to the following in your logs, then you will need to update to the [latest version](https://www.pagerduty.com/docs/guides/agent-install-guide/) of the agent:

Shell
```
09:36 | [1417765072] wproc: stderr line 01: Traceback (most recent call last): 
[1417765072] wproc: stderr line 02: File "/usr/share/pdagent-integrations/bin/pd-nagios", line 188, in <module> 
[1417765072] wproc: stderr line 03: main() 
[1417765072] wproc: stderr line 04: File "/usr/share/pdagent-integrations/bin/pd-nagios", line 117, in main 
[1417765072] wproc: stderr line 05: details = parse_fields(args.fields) 
[1417765072] wproc: stderr line 06: File "/usr/share/pdagent-integrations/bin/pd-nagios", line 177, in parse_fields 
[1417765072] wproc: stderr line 07: return dict(f.split("=", 2) for f in fields)

```

Bi-Directional Integration
==========================

The bidirectional integration utilizes a [CGI script](https://github.com/mdcollins05/pd-nag-connector/blob/master/pagerduty.cgi) to capture webhooks and process them into commands that Nagios runs, to add the acknowledgment note.

You may wish to capture an incident acknowledgment webhook for iterative testing and log-checking, for example, by sending it manually via [curl](https://curl.haxx.se/) or [Postman](https://www.getpostman.com/). You can do this by [creating a webhook](/main/docs/webhooks#add-a-v3-webhook-subscription-on-the-service-details-page) on your PagerDuty service and pointing it to a temporary [pipedream.com](https://pipedream.com/requestbin) URL to capture the JSON body, and acknowledging an incident that was raised from Nagios.

Once you have the JSON content of the webhook, you will be able to send the same webhook after each change and troubleshooting step attempted, without having to repeat the full process of raising an alert in Nagios and acknowledging it in PagerDuty. This allows more rapid testing and diagnosis of the CGI script that processes webhooks from PagerDuty.

CGI script cannot execute
-------------------------

Once you have put the script in place, try opening it in a HTTP client, for example, Perl or a web browser, with a `GET` request. You should receive a `400` error along with the message: `400 Requests must be POSTs`

### Response is 403 Forbidden

The [`pagerduty.cgi`](https://github.com/mdcollins05/pd-nag-connector/blob/master/pagerduty.cgi) script must be readable and executable by the web server process. If the process cannot read and execute the script file, it will in most cases respond to the request with a `403` status.

### Response is 401 Unauthorized

The script, or the directory it is in, may require authorization (e.g., [HTTP Basic Auth](https://en.wikipedia.org/wiki/Basic_access_authentication)). Check with your system administrator to see if this is the case. If HTTP Basic Auth is used, retry your GET request with `username:password@` prepended to the host name in the URL (i.e., immediately following `https://`).

### Response is 500 Internal Server Error

This indicates that the script itself is exiting prematurely with a non-success status due to an uncaught exception. The following dependencies (i.e., Perl modules) must be installed for the script to run properly:

* `JSON`
* `LWP::UserAgent`

The [Nagios Integration Guide](https://www.pagerduty.com/docs/guides/nagios-integration-guide/) outlines how to install these modules using native package management in CentOS and Ubuntu.

If you have verified that dependencies are met and you still receive a `500` status response, try running the script from the command line to see what error results in the output. There may be an issue with the Perl installation on the local machine, or a syntax error in the script caused by an accidental modification that resulted in invalid Perl syntax (e.g., missing a semicolon at the end of a line).

CGI script executes, but no notes are added to the Nagios alert
---------------------------------------------------------------

The CGI script writes to an "external commands" file that Nagios reads. This is the step when the PagerDuty incident acknowledgment is translated from a webhook into an action that Nagios takes (i.e., adding a note to the alert that it has been acknowledged in PagerDuty).

There are a few issues that could prevent this process from happening properly:

* Permissions on the command file/directory where it resides.
* The command file's path is in a different location than what is configured in the default Nagios installation.
* Nagios might not be configured to execute external commands.

In the Nagios configuration specification (per the [documentation on configuring external commands](https://assets.nagios.com/downloads/nagioscore/docs/nagioscore/3/en/extcommands.html)), the two directives `check_external_commands` and `command_file` are particularly helpful when troubleshooting the item above. The latter determines the path where the command file resides.

If you can verify that external commands are enabled in Nagios, per the `check_external_commands` option, and can obtain the path from the `command_file` option, then you can then check that against the path that is hard-coded in the CGI script, on [line 14](https://github.com/mdcollins05/pd-nag-connector/blob/master/pagerduty.cgi#L14):

Perl
```
'command_file' => '/var/lib/nagios3/rw/nagios.cmd', # External commands file

```
### File Permissions

There could also be an issue related to the command file's permissions, in which case you will need to check to see what user ID is running the script, and ensure it has write permission to the command file.

Updated 3 months ago

---

Learn more

* [Nagios Integration Guide](https://www.pagerduty.com/docs/guides/nagios-integration-guide/)
* [PagerDuty Agent Install Guide](https://www.pagerduty.com/docs/guides/agent-install-guide/)

* [Table of Contents](#)
* + [General Configuration](#general-configuration)
    - [Your Nagios host or service may not be reaching a HARD down state](#your-nagios-host-or-service-may-not-be-reaching-a-hard-down-state)
    - [ERROR NOTIFICATIONTYPE field must be present](#error-notificationtype-field-must-be-present)
  + [Perl-Based Integration](#perl-based-integration)
    - [Trigger a test incident to make sure that the Perl script will run](#trigger-a-test-incident-to-make-sure-that-the-perl-script-will-run)
    - [ERROR Nagios event in file /tmp/pagerduty\_nagios/pd\_12334543223\_1235.txt DEFERRED due to network/server problems.](#error-nagios-event-in-file-tmppagerduty_nagiospd_12334543223_1235txt-deferred-due-to-networkserver-problems)
    - [ERROR May 16 07:12:46 sw-cloud pagerduty\_nagios32356: open /tmp/pagerduty\_nagios/pd\_1337123566\_32999.txt for write failed: Illegal seek](#error-may-16-071246-sw-cloud-pagerduty_nagios32356-open-tmppagerduty_nagiospd_1337123566_32999txt-for-write-failed-illegal-seek)
    - [ERROR File was rejected because could not find CONTACTPAGER](#error-file-was-rejected-because-could-not-find-contactpager)
  + [Agent-Based Integration](#agent-based-integration)
    - [Trigger a test incident to make sure that the agent works](#trigger-a-test-incident-to-make-sure-that-the-agent-works)
    - [ERROR Error Performing CheckSum](#error-error-performing-checksum)
    - [Agent is not running](#agent-is-not-running)
    - [Outdated agent version](#outdated-agent-version)
  + [Bi-Directional Integration](#bi-directional-integration)
    - [CGI script cannot execute](#cgi-script-cannot-execute)
    - [CGI script executes, but no notes are added to the Nagios alert](#cgi-script-executes-but-no-notes-are-added-to-the-nagios-alert)
